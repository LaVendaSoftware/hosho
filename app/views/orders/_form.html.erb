<%= render(Components::PageTitle::Form.new(record: order, back_url: orders_path)) %>

<div class="flex flex-col gap-4 p-4 md:gap-6 md:p-6">
  <%= form_for(order) do |form| %>
    <%= render(Components::Form::BelongsToField.new(form, :customer, collection: current_customers.pluck("users.name", :id))) %>
    <%= render(Components::Form::TextField.new(form, :due_date, type: "date")) %>

    <div data-controller="nested-form" data-nested-form-wrapper-selector-value=".nested-form-wrapper">
      <div class="flex w-full cursor-vertical-text">
        <%= render(Components::Subtitle.new(tm(OrderItem))) %>
        <%= render(Components::NestedField::Add.new) %>
      </div>

      <template data-nested-form-target="template">
        <%= form.fields_for(:items, OrderItem.new, child_index: "NEW_RECORD") do |f| %>
          <%= render("order_items/nested_form", form: f) %>
        <% end %>
      </template>

      <%= form.fields_for(:items) do |f| %>
        <%= render("order_items/nested_form", form: f) %>
      <% end %>

      <div data-nested-form-target="target"></div>
    </div>

    <%= render(Components::Form::SubmitButton.new(form)) %>
  <% end %>
</div>
